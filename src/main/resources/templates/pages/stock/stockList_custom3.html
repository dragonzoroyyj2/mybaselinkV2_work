<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<head>
  <meta charset="UTF-8">
  <title>ì£¼ì‹ ì¢…ëª© ë¦¬ìŠ¤íŠ¸</title>

  <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ ìŠ¤íƒ€ì¼ -->
  <style>
    #loadingSpinner {
      display: none;
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(255,255,255,0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    #loadingSpinner .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* Toast ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    #toastContainer {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 99999;
    }
    .toast {
      margin-bottom: 8px;
      padding: 10px 15px;
      border-radius: 4px;
      color: #fff;
      opacity: 0.9;
      transition: all 0.3s;
      font-size: 0.9rem;
    }
    .toast-success { background-color: #4caf50; }
    .toast-info { background-color: #2196f3; }
    .toast-warning { background-color: #ff9800; }
    .toast-error { background-color: #f44336; }
  </style>
</head>

<body>
<div id="loadingSpinner"><div class="spinner"></div></div>
<div id="toastContainer"></div>

<div layout:fragment="content">
  <div class="content-container">
    <h2>ğŸ“Š ì£¼ì‹ ì¢…ëª© ë¦¬ìŠ¤íŠ¸</h2>

    <!-- ê²€ìƒ‰ë¼ì¸ -->
    <div class="toolbar">
      <div class="search-group">
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" />
        <button id="searchBtn" class="btn"><i class="fas fa-search"></i></button>
      </div>
    </div>

    <!-- ì´ê±´ + ê¸°ëŠ¥ ë²„íŠ¼ -->
    <div class="list-info">
      <span id="totalCount">ì´ 0ê±´</span>
      <div class="action-buttons">
        <button id="excelBtn" class="btn excel" title="ì—‘ì…€ ë‹¤ìš´ë¡œë“œ"><i class="fa-solid fa-file-excel"></i></button>
        <button id="addBtn" class="btn" title="ì¶”ê°€"><i class="fas fa-plus"></i></button>
        <button id="deleteSelectedBtn" class="btn red" title="ì‚­ì œ"><i class="fas fa-trash"></i></button>
      </div>
    </div>

    <!-- í…Œì´ë¸” -->
    <div class="table-container">
      <table>
        <thead>
        <tr>
          <th><input type="checkbox" id="checkAll" /></th>
          <th>No</th>
          <th>ì¢…ëª©ì½”ë“œ</th>
          <th>íšŒì‚¬ëª…</th>
          <th>ì‹œì¥êµ¬ë¶„</th>
          <th>ì—…ì¢…</th>
          <th>ì¢…ê°€</th>
          <th>ì‹œê°€</th>
          <th>ê³ ê°€</th>
          <th>ì €ê°€</th>
          <th>ê±°ë˜ëŸ‰</th>
          <th>ê¸°ì¤€ì¼</th>
        </tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
    </div>

    <!-- í˜ì´ì§• -->
    <div id="pagination" class="pagination"></div>
  </div>

  <!-- ë“±ë¡ ëª¨ë‹¬ -->
  <div id="addModal" class="modal">
    <div class="elegant-modal">
      <div class="elegant-header">
        <h3>ì„œë²„ ë“±ë¡</h3>
        <span data-close="addModal" class="close-btn">&times;</span>
      </div>
      <div class="elegant-body">
        <div class="form-group"><label>ì œëª©</label><input id="titleInput" /></div>
        <div class="form-group"><label>ë‹´ë‹¹ì</label><input id="ownerInput" /></div>
        <div class="form-group"><label>ì„œë²„ ì¢…ë¥˜</label>
          <select id="serverType"><option>ì›¹ ì„œë²„</option><option>DB ì„œë²„</option><option>API ì„œë²„</option></select>
        </div>
        <div class="form-group"><label>ìš´ì˜ ìƒíƒœ</label>
          <div class="option-group">
            <label><input type="radio" name="status" value="active" checked>ìš´ì˜</label>
            <label><input type="radio" name="status" value="pause">ì¤‘ì§€</label>
          </div>
        </div>
        <div class="form-group"><label>ê¸°ëŠ¥ ì˜µì…˜</label>
          <div class="option-group">
            <label><input type="checkbox">ë°±ì—… í™œì„±í™”</label>
            <label><input type="checkbox">ìë™ ëª¨ë‹ˆí„°ë§</label>
          </div>
        </div>
        <div class="form-group"><label>ë“±ë¡ì¼</label><input type="date" id="regDateInput" /></div>
        <div class="form-group"><label>ë¹„ê³ </label><textarea id="noteInput" rows="3"></textarea></div>
      </div>
      <div class="modal-footer elegant-footer">
        <button id="saveBtn" class="btn">ì €ì¥</button>
        <button class="btn gray" data-close="addModal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ìƒì„¸ / ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="detailModal" class="modal">
    <div class="elegant-modal">
      <div class="elegant-header">
        <h3>ìƒì„¸ ì •ë³´</h3>
        <span data-close="detailModal" class="close-btn">&times;</span>
      </div>
      <div class="elegant-body">
        <div class="form-group"><label>No</label><input id="detailId" readonly /></div>
        <div class="form-group"><label>ì œëª©</label><input id="detailTitle" /></div>
        <div class="form-group"><label>ë‹´ë‹¹ì</label><input id="detailOwner" /></div>
        <div class="form-group"><label>ë“±ë¡ì¼</label><input id="detailRegDate" readonly /></div>
        <div class="form-group"><label>ì„œë²„ ìƒíƒœ</label>
          <select><option>ì •ìƒ</option><option>ì ê²€ì¤‘</option></select>
        </div>
        <div class="form-group"><label>ê¸°ëŠ¥ ì˜µì…˜</label>
          <div class="option-group">
            <label><input type="checkbox">ë°±ì—… í™œì„±í™”</label>
            <label><input type="checkbox">ìë™ ëª¨ë‹ˆí„°ë§</label>
          </div>
        </div>
        <div class="form-group"><label>ë¹„ê³ </label><textarea id="detailNote" rows="3"></textarea></div>
      </div>
      <div class="modal-footer elegant-footer">
        <button id="updateBtn" class="btn">ìˆ˜ì •</button>
        <button class="btn gray" data-close="detailModal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!-- í˜ì´ì§€ë³„ ìŠ¤í¬ë¦½íŠ¸ -->
<th:block layout:fragment="pageScript">
<script src="/js/commonPagination_op.js"></script>
<script src="/js/commonUnifiedList_opV3.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // =======================
  // Toast/Notify êµ¬í˜„ (ì‹¤ì œ ìš´ì˜ìš©)
  // =======================
  if (!window.notify) {
    window.notify = function(type, message) {
      const container = document.getElementById('toastContainer');
      if (!container) return;
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => { toast.remove(); }, 3000);
      console.log(`[${type.toUpperCase()}] ${message}`);
    };
  }

  // =======================
  // ë°˜ì‘í˜• í˜ì´ì§€ ê·¸ë£¹ ê³„ì‚°
  // =======================
  function getPageGroupSize() {
    const width = window.innerWidth;
    if (width < 480) return 3;
    if (width < 768) return 5;
    if (width < 1024) return 10;
    return 20;
  }

  let pageGroupSize = getPageGroupSize();

  // =======================
  // ê³µìš© ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™” (V3)
  // =======================
  const defaultButtons = {
    searchInputSelector: "#searchInput",
    searchBtnSelector: "#searchBtn",
    addBtnSelector: "#addBtn",
    saveBtnSelector: "#saveBtn",
    detailUpdateBtnSelector: "#updateBtn",
    detailDeleteBtnSelector: "#deleteSelectedBtn",
    deleteSelectedBtnSelector: "#deleteSelectedBtn",
    checkAllSelector: "#checkAll",
    excelBtnSelector: "#excelBtn"
  };

  const unifiedListManager = initUnifiedList({
    mode: "server",
    pagination: true,
    apiUrl: "/api/stock/list",
    tableBodySelector: "#dataTable",
    paginationSelector: "#pagination",
    searchInputSelector: defaultButtons.searchInputSelector,
    searchBtnSelector: defaultButtons.searchBtnSelector,
    addBtnSelector: defaultButtons.addBtnSelector,
    saveBtnSelector: defaultButtons.saveBtnSelector,
    deleteSelectedBtnSelector: defaultButtons.deleteSelectedBtnSelector,
    excelBtnSelector: defaultButtons.excelBtnSelector,
    checkAllSelector: defaultButtons.checkAllSelector,
    columns: [
      { key: "id", label: "No" },
      { key: "Code", label: "ì¢…ëª©ì½”ë“œ" },
      { key: "Name", label: "íšŒì‚¬ëª…", isDetailLink: true },
      { key: "Market", label: "ì‹œì¥êµ¬ë¶„" },
      { key: "Dept", label: "ì—…ì¢…" },
      { key: "Close", label: "ì¢…ê°€" },
      { key: "Open", label: "ì‹œê°€" },
      { key: "High", label: "ê³ ê°€" },
      { key: "Low", label: "ì €ê°€" },
      { key: "Volume", label: "ê±°ë˜ëŸ‰" },
      { key: "Date", label: "ê¸°ì¤€ì¼" }
    ],
    pageSize: 10,
    pageGroupSize: pageGroupSize,
    enableRowClickDetail: true,
    enableDetailView: true,
    detailViewButtons: {
      update: defaultButtons.detailUpdateBtnSelector,
      delete: defaultButtons.detailDeleteBtnSelector
    }
  });
  
  /*
  const addUserBtn = document.getElementById("addUserBtn");
  if (addUserBtn) {
    addUserBtn.addEventListener("click", () => {
      alert("ì‚¬ìš©ì ì¶”ê°€ ëª¨ë‹¬ì„ ì—¬ëŠ” ì»¤ìŠ¤í…€ ë¡œì§");
      // ì‚¬ìš©ì ì¶”ê°€ ë¡œì§ (ì˜ˆ: ë³„ë„ì˜ API í˜¸ì¶œ, íŠ¹ì • í¼ ì´ˆê¸°í™” ë“±)
    });
  }

  const customFilterBtn = document.getElementById("customFilterBtn");
  if (customFilterBtn) {
    customFilterBtn.addEventListener("click", () => {
      alert("ì»¤ìŠ¤í…€ í•„í„°ë§ ë¡œì§ ì‹¤í–‰");
      // í•„í„°ë§ ë¡œì§ êµ¬í˜„ (ì˜ˆ: íŠ¹ì • íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ì—¬ loadList í˜¸ì¶œ)
    });
  }
  */

  // =======================
  // í™”ë©´ ë¦¬ì‚¬ì´ì¦ˆ ì‹œ í˜ì´ì§€ ê·¸ë£¹ ì¬ì¡°ì •
  // =======================
  window.addEventListener("resize", () => {
    const newGroupSize = getPageGroupSize();
    if (newGroupSize !== pageGroupSize) {
      pageGroupSize = newGroupSize;
      unifiedListManager.pageGroupSize = newGroupSize;
      const event = new Event("resizePagination");
      document.dispatchEvent(event);
    }
  });
});
</script>
</th:block>
</body>
</html>
